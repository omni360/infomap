function m(){var e=new Image;e.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var t=e.getContext("2d");t.drawImage(this,0,0),imageW=e.width,imageH=e.height;var n=t.getImageData(0,0,imageW,imageH).data,r=0,i=0;for(var s=0;s<imageW;++s){for(var o=0;o<imageH;++o){var u=n[r],a=n[r+1],f=n[r+2],c=n[r+3];r=s*4+o*4*imageW;var h=u+a+f;if(h>100){var p={x:s-imageW/2,y:o-imageH/2,scale:h,mod:i,delay:1-s/imageW};l.push(p)}}++i}g(),S()},e.src="assets/images/map_small.jpg"}function g(){e=document.createElement("div"),document.body.appendChild(e),n=new THREE.Scene,n.fog=new THREE.Fog(0,30,590),t=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4),t.position.z=-200,t.lookAt(n.position),n.add(t),f=new THREE.Object3D,f.rotation.y=Math.PI-.4,n.add(f);var i=new THREE.Object3D;i.rotation.x=-Math.PI/2,f.add(i);var o=100,u=new THREE.Geometry,a=[],d=Math.PI*2/256,v=Math.PI/128;for(_=0;_<l.length;_++){var m=0;l[_].mod%2==0&&(m=.5);var g=l[_].x*d,b=(l[_].y-m)*v,w=l[_].scale/765,E=new THREE.Vector3;E.x=o*Math.cos(b)*Math.cos(g),E.y=o*Math.cos(b)*Math.sin(g),E.z=o*-Math.sin(b),u.vertices.push(E)}h={size:{type:"f",value:[]},time:{type:"f",value:[]},customColor:{type:"c",value:[]}},c={color:{type:"c",value:new THREE.Color(16777215)},globalTime:{type:"f",value:2.4},texture:{type:"t",value:THREE.ImageUtils.loadTexture("assets/images/dot.png")}};var S=new THREE.ShaderMaterial({uniforms:c,attributes:h,vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.NormalBlending,depthTest:!0,transparent:!0}),x=u.vertices,T=h.size.value,N=h.time.value,C=h.customColor.value,a=[new THREE.Color(5799762),new THREE.Color(11253674),new THREE.Color(658697),new THREE.Color(5145410),new THREE.Color(8490623)];for(var k=0;k<x.length;k++)T[k]=1+Math.random()*3,C[k]=a[Math.floor(Math.random()*a.length)],N[k]=l[k].delay;var L=new THREE.ParticleSystem(u,S);i.add(L),lineGeometry=new THREE.Geometry;for(_=0;_<l.length;_++)if(Math.random()>.985){var E=u.vertices[_].clone();if(E.z<-90||E.z>90)continue;vertex2=E.clone(),vertex2.multiplyScalar(1.1),lineGeometry.vertices.push(E),lineGeometry.vertices.push(vertex2)}var A=new THREE.LineBasicMaterial({color:16777215,opacity:0,linewidth:1}),O=new THREE.Line(lineGeometry,A,THREE.LinePieces);i.add(O);var M=new THREE.Geometry;for(var _=0;_<lineGeometry.vertices.length;_++)if(_%2==1&&Math.random()>.5){var D=lineGeometry.vertices[_].clone();D.multiplyScalar(1.02),M.vertices.push(D)}var P=new THREE.ParticleBasicMaterial({map:THREE.ImageUtils.loadTexture("assets/images/hex.png"),opacity:0,size:3,transparent:!0,alphaTest:.5}),H=new THREE.ParticleSystem(M,P);i.add(H);for(var B=0;B<14;B++){var j=new THREE.Geometry,a=[];for(_=0;_<50;_++){j.vertices.push(new THREE.Vector3);var F=new THREE.Color(16777215);F.setHSV(.15,.6,1-_/50),a.push(F)}j.colors=a;var S=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.VertexColors}),I=new THREE.Line(j,S);j.dynamic=!0,I.frustumCulled=!1,i.add(I),p.push({geometry:j,mesh:I,id:B,startPoint:null,endPoint:null,currentPoint:null,animationTime:0}),y(B,3e3+B*200)}var q=(new TWEEN.Tween(c.globalTime)).to({value:0},4e3).easing(TWEEN.Easing.Linear.EaseNone).delay(100);q.start();var R=(new TWEEN.Tween(A)).to({opacity:1},2e3).easing(TWEEN.Easing.Linear.EaseNone).delay(1500);R.start(),H.scale.set(.9,.9,.9);var U=(new TWEEN.Tween(H.scale)).to({x:1,y:1,z:1},3e3).easing(TWEEN.Easing.Elastic.EaseOut).delay(2500);U.start();var z=(new TWEEN.Tween(P)).to({opacity:1},3e3).easing(TWEEN.Easing.Linear.EaseNone).delay(1e3);z.start(),r=new THREE.WebGLRenderer({antialias:!0}),r.setSize(window.innerWidth,window.innerHeight),THREEx.WindowResize(r,t),e.appendChild(r.domElement),s=!0}function y(e,t){var n=p[e],r=Math.floor(Math.random()*lineGeometry.vertices.length/2)*2;n.startPoint=lineGeometry.vertices[r].clone();var r=Math.floor(Math.random()*lineGeometry.vertices.length/2)*2;n.endPoint=lineGeometry.vertices[r].clone();var i=n.startPoint.distanceTo(n.endPoint),s=Math.max(3e3,i*40);n.currentPoint=n.startPoint.clone(),n.animationTime=0;var o=t||0,u=(new TWEEN.Tween(n)).to({animationTime:.35},s).easing(TWEEN.Easing.Sinusoidal.EaseIn).delay(o).onComplete(function(){setTimeout(y(e,200+Math.random()*300),1500)});u.start();for(var a=0;a<n.geometry.vertices.length;a++)n.geometry.vertices[a]=n.currentPoint.clone();n.geometry.verticesNeedUpdate=!0}function b(){for(var e=0;e<p.length;e++){var t=p[e];t.currentPoint.lerpSelf(t.endPoint,t.animationTime);var n=110;for(var r=0;r<t.geometry.vertices.length;r++)r==0?t.geometry.vertices[r]=t.currentPoint.clone().setLength(n):t.geometry.vertices[r].lerpSelf(t.geometry.vertices[r-1],.35).setLength(n);t.geometry.verticesNeedUpdate=!0}}function w(e){var t=window.innerWidth>>1,n=window.innerHeight>>1;d=e.clientX-t,v=e.clientY-n}function E(e){e.preventDefault();var t=window.innerWidth>>1,n=window.innerHeight>>1;d=(e.touches[0].clientX-t)*-1,v=(e.touches[0].clientY-n)*-1}function S(){requestAnimationFrame(S),x()}function x(){u=(new Date).getTime(),o=u-a,a=u;if(isNaN(o)||o>1e3||o==0)o=1e3/60;t.position.y+=(-150*Math.sin(v/500)-t.position.y)/10,t.lookAt(n.position),f.rotation.y-=d/2e4,TWEEN.update(),b(),s&&r.render(n,t)}var e,t,n,r,i,s=!1,o,u,a,f,l=[],c,h,p=[],d=0,v=0;document.addEventListener("mousemove",w,!1),document.addEventListener("touchmove",E,!1),m()