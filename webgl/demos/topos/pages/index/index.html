<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<title>Topos</title>
	<link rel="stylesheet" href="../../css/base.css" type="text/css" media="screen" title="no title" charset="utf-8"/>
	<link href="../../otherlib/customIcon/style.css" rel="stylesheet">
	<link rel="stylesheet" href="../../css/aa.css" type="text/css" media="screen" title="no title" charset="utf-8"/>
	
	<style type="text/css">
		#topo{
			height: -webkit-calc(100% - 0px);
		}
	</style>
	
	
</head>
<body>
	<!-- 实例主体 -->
	<div id="topo"></div>
	<div class="link-picture-control clearfix">
		<div class="link-picture">
			<ul>
			
			</ul>
		</div>
		<div class="link-dot clearfix">
			<button id="left" class="leftable"></button>
			<button id="right" class="rightable"></button>
	
		</div>
		<div class="linka clearfix">
			<ul >
			</ul>
		</div>
	</div>
</body>
<!-- Libs-->
<script src="../../js/homeTopos.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/libs/jquery-1.7.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../otherlib/jqueryui/jquery-ui.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/lib/raphael.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/libs/jquery.mousewheel.min.js"></script>
<script src="../../rebuild/src/libs/jquery.mCustomScrollbar.js"></script>
<script src="../../rebuild/src/libs/three.js" type="text/javascript" charset="utf-8"></script>
<!-- <script src="src/libs/effects/three.min.r52.js" type="text/javascript" charset="utf-8"></script> -->
<script src="../../rebuild/src/libs/Collisions.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/libs/TrackballControls.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/libs/Tween.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/libs/highcharts.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/libs/dark-green.js" type="text/javascript" charset="utf-8"></script>
<!-- 主类、材质、动画库-->
<script src="../../rebuild/src/OOPTEST.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/textures/TexturesLibrary.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/animations/Animation.js" type="text/javascript" charset="utf-8"></script>
<!-- 网关  -->
<script src="../../rebuild/src/gateways/Gateways.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/gateways/GatewayRequest.js" type="text/javascript" charset="utf-8"></script>
<!-- 场景视口-->
<script src="../../rebuild/src/space3d/scenes/Scene.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/scenes/Viewport.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/scenes/Scene.js" type="text/javascript" charset="utf-8"></script>
<!-- 模型-->
<script src="../../rebuild/src/space3d/models/Model.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/bases/Circle.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/bases/Arrow.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/bases/Mark.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/Gyroscope.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/Floor.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/Star.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/bases/DashedLine.js" type="text/javascript" charset="utf-8"></script>

<script src="../../rebuild/src/space2d/models/BaseSvgModel.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/models/ZoomRulerSvgModel.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/models/HostMenuSvgModel.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/models/MsgCardModel.js" type="text/javascript" charset="utf-8"></script>
<!-- 区块 -->
<script src="../../rebuild/src/space2d/functionspan/topoinfo/topoInfo.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/mapstyle/mapStyle.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/findNode/findNode.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/dynamichart/dynamiChart.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/showLog/replayLog.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/showLog/showLog.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/showLog/historyLog.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/menupanel/menuPanel.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/eventlist/eventList.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/replayBar/replayBar.js" type="text/javascript" charset="utf-8"></script>
<!-- 主体拓扑	-->
<script src="../../rebuild/src/space3d/models/bases/NodeSystem.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/models/TopoSystemTween.js" type="text/javascript" charset="utf-8"></script>
<!-- 人机交互事件 -->
<script src="../../rebuild/src/space3d/events/Event.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/events/ResizeEvent.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/events/RayEvent.js" type="text/javascript" charset="utf-8"></script>
<!-- 安全事件-->
<script src="../../rebuild/src/space3d/securevents/SecurEvent.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/securevents/FtpEventTween.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/securevents/MailEventTween.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space3d/securevents/WormEvent.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/showLog/MessageEvent.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/functionspan/showLog/historyMsgEvent.js" type="text/javascript" charset="utf-8"></script>
<!-- 工具类 -->
<script src="../../rebuild/src/space3d/utils/Utils.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/utils/ImgUnitls.js" type="text/javascript" charset="utf-8"></script>
<script src="../../rebuild/src/space2d/utils/StringUtils.js" type="text/javascript" charset="utf-8"></script>
<!-- 系统调度器-->
<script src="../../rebuild/src/system/AppConfigMain.js" type="text/javascript" charset="utf-8"></script>


<script type="text/javascript" charset="utf-8">
	window.parent.topo.isRenderer = false;
	//屏蔽鼠标事件
    document.oncontextmenu = function (){
        return false;
    };
	var system;
	
	function init(){
		
		//system = new OOPTEST.System('ALL', 'current');
		system = new OOPTEST.System('SPACE3D', 'history', 7000, 8000);
		
		$("#left_toggle_btn").attr('switch', '1');
		$("#left_toggle_btn").click(function (e){
			
			$("#app_config_div").animate({
				left: $(this).attr('switch') == true ? '10px' : '-515px'
			})
			$(this).attr('switch', $(this).attr('switch') != '0' ? '0' : '1')
			
		})
		
		$("#right_toggle_btn").attr('switch', '1');
		$("#right_toggle_btn").click(function (e){
			
			$("#monitor_config_div").animate({
				right: $(this).attr('switch') == true ? '10px' : '-515px'
			})
			$(this).attr('switch', $(this).attr('switch') != '0' ? '0' : '1');
		})
		
		var scanInterval = $( "#scanInterval" ).spinner();
		var infectionPercent = $( "#infectionPercent" ).spinner();
		var hostPercent = $( "#hostPercent" ).spinner();
		var wormStartTime = $( "#wormStartTime" ).spinner();
		var wormEndTime = $( "#wormEndTime" ).spinner();
		var attackPowerStartRound = $( "#attackPowerStartRound" ).spinner();
		var attackPowerEndRound = $( "#attackPowerEndRound" ).spinner();
		var attackPowerDistri = $( "#attackPowerDistri" ).spinner();
		var ddosInfectionPercent = $( "#ddosInfectionPercent" ).spinner();
		var ddosDostPercent = $( "#ddosDostPercent" ).spinner();
		var ddosStartTime = $( "#ddosStartTime" ).spinner();
		var ddosEndTime = $( "#ddosEndTime" ).spinner();
		
	}
	
	var data = [
		{
			'id': '0',
			'status': '0',
			'src':'../../image/topo/topo_event_timer.png'
		},
		
		{
			'id': '2',
			'status': '2',
			'src':'../../image/topo/topo_event_timer3.png'
		},
		{
			'id': '3',
			'status': '3',
			'src':'../../image/topo/topo_event_timer4.png'
		},
		{
			'id': '4',
			'status': '0',
			'src':'../../image/topo/topo_event_timer5.png'
		},
		{
			'id': '1',
			'status': '1',
			'src':'../../image/topo/topo_event_timer2.png'
		},
		
		{
			'id': '6',
			'status': '0',
			'src':'../../image/topo/topo_event_timer7.png'
		},
		{
			'id': '7',
			'status': '0',
			'src':'../../image/topo/topo_event_timer8.png'
		},
		{
			'id': '8',
			'status': '2',
			'src':'../../image/topo/topo_event_timer9.png'
		},
		{
			'id': '5',
			'status': '1',
			'src':'../../image/topo/topo_event_timer6.png'
		}
	]
	
	//fill="rgba(14,165,204,0.1)" stroke="rgba(14,165,204,0.9)"  stroke-width="1.5"
	$(function(){
		init();
		
		var arrowleft,arrowright,arrowleftglow,arrowrightglow;
		
		var imghtml='',dothtml='';
		var activeIndex = (homeTopoList.length + 1)/2 - 1;
		for(var i in homeTopoList){
			activeIndex == i ? imghtml+='<li>' : imghtml+='<li class="normalp">';
			imghtml+='<div class="svg-dom" id="svgdom_'+i+'">'+'</div></li>' ;
			activeIndex == i ? dothtml+='<li class="linka-dot linka-active"></li>' : dothtml+='<li class="linka-dot"></li>';
			
		}
		$('.link-picture ul').html(imghtml);
		$('.linka ul').html(dothtml);
		
		var buttons = [];
		
		for(var i in homeTopoList){
			
			var r = Raphael('svgdom_'+i,250,180);
				r.index = i;
			
			draw(r);
		}
		
		function draw(dom){
			var paper = dom,
				w = 220,
				h = 150;
			var color = [
				'#56A079',
				'#C2A84B',
				'#DF6C4F',
				'#BE1655'
			];
			// paper.rect(1, 1, w, h,2).attr({
                // stroke: "rgba(14,165,204,0.9)", 
                // "stroke-width": 2, 
                // 'fill' : 'rgba(4, 63, 85, 0.51)'
            // });
            
            paper.rect(15, 15, w, h,2).attr({
                stroke: "rgba(14,165,204,1)", 
                "stroke-width": 2, 
                'fill' : 'none'
            });
            
            paper.image(data[i].src, 16, 16, w-2, h-2);
            
	
            
            // paper.path('M1,35.5L25,50.5').attr({
            	// stroke: "rgba(14,165,204,0.9)", 
                // "stroke-width": 2, 
                // 'fill' : 'rgba(4, 63, 85, 0.51)'
            // });
// 		            
            // paper.path('M'+(w-25)+',50.5L'+(w+1)+',35.5').attr({
            	// stroke: "rgba(14,165,204,0.9)", 
                // "stroke-width": 2, 
                // 'fill' : 'rgba(4, 63, 85, 0.51)'
            // });
// 		            
            // paper.path('M1,'+h+'L25,160').attr({
            	// stroke: "rgba(14,165,204,0.9)", 
                // "stroke-width": 2, 
                // 'fill' : 'rgba(4, 63, 85, 0.51)'
            // });
// 		            
            // paper.path('M249,179L223,159').attr({
            	// stroke: "rgba(14,165,204,0.9)", 
                // "stroke-width": 2, 
                // 'fill' : 'rgba(4, 63, 85, 0.51)'
            // });
            paper.path('M15, 15h'+w).attr({
            	'fill': color[data[i].status],
            	"stroke-width": 2, 
	            stroke: color[data[i].status], 
            })
            var circle_attr = {
	            	'fill': color[data[i].status],
	            	stroke: color[data[i].status], 
	            },
	            circle_r = 3;
            
            paper.circle(15, 15, circle_r).attr(circle_attr);
            
            paper.circle(15, 15, circle_r+3).attr(circle_attr).attr({
            	fill: 'none',
            	"stroke-width": 2
            })
            // paper.circle(15, h+15, circle_r).attr(circle_attr);
            paper.circle(15+w, 15,circle_r+1).attr(circle_attr);
            // paper.circle(15+w, h+15,circle_r).attr(circle_attr);
            
            // var tempw = 7,
            	// temph = 27,
            	// theat = Math.PI*60/180;
// 		            
            // var pointa = 25,
            	// pointb = 10;
            var flag = true;
            function t(w,h,a,b,t){
            	theat = Math.PI*t/180;
            	paper.path('M'+a+','+b+'L'+(a-h/Math.tan(theat))+','+(b+h)+'h'+w+'L'+(a+w)+','+b+'z').attr({
	            	stroke: color[data[i].status], 
	                "stroke-width": 1, 
	                'fill' : color[data[i].status]
	            }).glow({
	            	'color': color[data[i].status],
	            	'width': 1
	        	});
	            flag && paper.text(a,b+11,homeTopoList[data[i].id]['name']).attr({
	            	'fill': '#ddd',
	            	'font-size': '15px',
	            	'letter-spacing': '1px',
	            	'text-anchor': 'start',
	            	'font-weight': 'bold',
	            	'font-family': "'Maven Pro','微软雅黑', sans-serif"
	            })
	            flag = false;
            }
            	
            t(177,22,32,4,60);
            t(8,22,213,4,60);
            t(5,22,225,4,60);
            // t(3,17,43,16,60);
            
            
            
            function button(w,h,a,b,t){
            	theat = Math.PI*t/180;
            	var btn = paper.path(
            		'M'+a+','+b+
            		'L'+(a-h/2*Math.tan(theat/2))+','+(b+h/2)+'L'+a+','+(b+h)+
            		'h'+w+
            		'L'+(a+h/2*Math.tan(theat/2)+w)+','+(b+h/2)+
            		'L'+(a+w)+','+b+
            	'z').attr({
	            	stroke: "rgba(14,165,204,0.9)", 
	                "stroke-width": 2, 
	                'fill' : 'rgba(4, 63, 85, 1)',
	                'fill-opacity' : '1'
	            });
	            
	            buttons.push(btn);
	            
	            paper.text((a+w/2+1),9.5+b,'查看').attr({
	            	'fill': '#FFF',
	            	'letter-spacing': '2px',
	            	'font-size': '12px',
	            	'cursor': 'pointer',
	            	'font-weight': 'bold',
	            	'font-family': '微软雅黑'
	            });
	            
	            
	            var btnfont = paper.path(
            		'M'+a+','+b+
            		'L'+(a-h/2*Math.tan(theat/2))+','+(b+h/2)+'L'+a+','+(b+h)+
            		'h'+w+
            		'L'+(a+h/2*Math.tan(theat/2)+w)+','+(b+h/2)+
            		'L'+(a+w)+','+b+
            	'z').attr({
	            	stroke: "rgba(14,165,204,0)", 
	                "stroke-width": 2, 
	                'fill' : 'rgba(4, 63, 85, 0)'
	            })
	            .data("i", data[i].id)
	            .data("rindex", r.index)
	            .hover(function(){
	            	if(buttonActive == this.data('rindex')) return false;
	            	btn.attr({
	            		'fill': 'rgba(14,165,204,1)'
	            	})
	            },function(){
	            	if(buttonActive == this.data('rindex')) return false;
	            	btn.attr({
	            		'fill': 'rgba(4, 63, 85, 1)'
	            	});
	            }).click(function(){
	            	buttons[buttonActive].attr({
						'fill' : 'rgba(4, 63, 85, 1)'
					});
					buttons[this.data('rindex')].attr({
						fill: "rgba(14,165,204,1)"
					});
					buttonActive = this.data('rindex');
	            	system.update(homeTopoList[parseInt(this.data('i'))]['data'],false);
	            });
            }
            
            button(36,20,108,h+5,90);
            
		};
		
		$('.link-dot #left').css({
			'left': window.innerWidth/2 - 185
		});
		
		$('.link-dot #right').css({
			'left': window.innerWidth/2 - 134 + 277
		});
		
		var paperWidth = $('.leftable').css('width').split('p')[0],
			paperHeight = $('.leftable').css('height').split('p')[0],
			paperleft = Raphael('left',paperWidth,paperHeight),
			paperright = Raphael('right',paperWidth,paperHeight);
		
		calArrowPath(paperWidth,paperHeight,[15,15]);
		
		function calArrowPath(W,H,paddings){
			var tempH = (H/2 - paddings[0]),
				tempW = (W-paddings[1]*2),
				w = tempH/Math.sqrt(3),
				a = (w + paddings[1]),
				b = paddings[0];
				arrowleft = paperleft.path(returnpath('M#,#L#,#L#,#h#L#,#L#,#h#z',[a,b,paddings[1],H/2,a,(H - paddings[0]),(tempW-w),(tempW-w+paddings[1]),H/2,(a+tempW-w),b,(w-tempW)])).attr({
					'stroke': 'rgba(255,255,255,0.9)'
				}).hover(function(){
					this.attr({'fill': '#FFF'});
				},function(){
					this.attr({'fill': 'none'});
				});
				arrowright = paperright.path(returnpath('M#,#L#,#L#,#h#L#,#L#,#h#z',[a,b,paddings[1],H/2,a,(H - paddings[0]),(tempW-w),(tempW-w+paddings[1]),H/2,(a+tempW-w),b,(w-tempW)])).attr({
					'stroke': 'rgba(255,255,255,0.9)'
				}).hover(function(){
					this.attr({'fill': '#FFF'});
				},function(){
					this.attr({'fill': 'none'});
				});
				
				arrowright.transform('r180');
	
			arrowleftglow = arrowleft.glow({
				'color': '#FFF'
			})
			arrowrightglow = arrowright.glow({
				'color': '#FFF'
			})
		}
	
		function returnpath(mod,val){
			
			var _temppath = '',
				_j = 0;
			for (var i = 0, temp; temp = mod[i]; i++) {
				if(temp === '#') {
					_temppath += (val[_j] ? val[_j] : 0);
					_j++;
				}else{
					_temppath += temp;
				}
			}
			return _temppath;
		}
		
		
		
		$('.link-picture ul li').css({
			'left': (window.innerWidth-372)/2
		});
		$('.linka').css({
			'left': (window.innerWidth - (data.length*15))/2
		});
		system.update(homeTopoList[data[activeIndex].id]['data']);
		buttons[activeIndex].attr({
			fill: "rgba(14,165,204,0.9)"
		});
		var buttonActive = activeIndex;
		$('.link-picture-info button').each(function(i){
			$(this).click(function(){
				system.update(topoJsonList[$(this).attr('data')],false);
				$('.link-picture-info button').removeClass('currentScene');
				$(this).addClass('currentScene');
			});
		});
	
		var lis = $('.link-picture ul li');
		var linka = $('.linka ul li'),
			transform = function(element, value, key) {
				key = key || "Transform";
				["Moz", "O", "Ms", "Webkit", ""].forEach(function(prefix) {
					element.style[prefix + key] = value;	
				});	
				
				return element;
			}
		
		changepicture(0,0);
		
		lis.each(function(i){
			$(this).click(function(){
				activeIndex = i;
				changepicture(0,0);
			})
		});
		
		linka.each(function(i){
			$(this).click(function(){
				activeIndex = i;
				changepicture(0,0);
			})
		});
		
		$('#right').click(function(){

			if(activeIndex == data.length -1 ) return false;
			
			activeIndex++;
			
			changepicture(0,0);
			
		});
		$('#left').click(function(){
			
			
			if(activeIndex == 0) return false; 
			
			activeIndex--;
			
			changepicture(0,0);
		});
		
		function changepicture(_middle,_blank){
			_middle = 200, _blank = 110;
			arrowleft.show();
			arrowleftglow.show();
			if(activeIndex == 0) {
				arrowleftglow.hide();
				arrowleft.hide();
			};
			arrowright.show();
			arrowrightglow.show();
			if(activeIndex == data.length -1) {
				arrowrightglow.hide();
				arrowright.hide();
			};
			linka.removeClass('linka-active');
			linka.eq(activeIndex).addClass('linka-active');
			// lis.each(function(i){
				// if(activeIndex > i){
					// transform(this, "perspective(300px) scale(0.6) rotateY(45deg) translate3d("+((-_blank)*(activeIndex-i)-_middle)+"px,0,"+((-_blank)*(activeIndex-i)-_middle)+"px)");	
				// }else if(activeIndex < i){
					// transform(this, "perspective(300px) scale(0.6) rotateY(-45deg) translate3d("+((_blank)*(i-activeIndex)+_middle)+"px,0,"+((-_blank)*(i-activeIndex)-_middle)+"px)");	
				// }else{
					// transform(this, "perspective(300px) scale(1)");	
				// }
// 					
			// });
			var theat = 10,
				xoffset = -130,
				R = 100;
			
			lis.each(function(i){
				if(activeIndex > i){
					transform(this, "translate3d("+((i-activeIndex)*R*2.5+xoffset)+"px,"+(activeIndex-i)*R/10+"px,"+(i-activeIndex)*R+"px) rotateY(15deg)");	
				}else if(activeIndex < i){
					transform(this, "translate3d("+((i-activeIndex)*R*2.5-xoffset)+"px,"+(i-activeIndex)*R/10+"px,"+(activeIndex-i)*R+"px) rotateY(-15deg)" );	
				}else{
					transform(this, "");	
				}
				
			});
		}
		
		function P(info){
			console.info(info);
		}
	});
	
</script>
</html>