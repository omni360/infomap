function AntiyTopo(B){this.settings=B||{};AntiyTopo.prototype.init=function(){window.AntiyTopos||(window.AntiyTopos=[]),window.AntiyTopos.push(this),this.DEFAULT_WIDTH=960,this.DEFAULT_HEIGHT=450,this.solarDictionary={},this.solarDictionaryID={},this.dataSourcesLoaded=0,this.mouseLastMovePoint=new Object,this.mouseDownPoint=new Object,this.fullscreen=!1,this.mapMoving=!1,this.datasources=[],this.moveCount=0,this.settings.views!=undefined&&(this.views=this.settings.views),this.containerId=this.settings.parentElementId,this.container=document.getElementById(this.containerId),this.animation=false;this.first_flag=true;this.lineSplice=50;this.middlePoint=new THREE.Vector3();this.isRenderer=true;this.moveLineMaterial=new THREE.LineBasicMaterial({color:16711680,opacity:1,linewidth:1,});this.moveLines=[];this.wormSprites=[];this.wormFlagNumber=0;this.highLightSprites={};this.imgHost=THREE.ImageUtils.loadTexture("image/textures/host.png");this.imgRouter=THREE.ImageUtils.loadTexture("image/textures/router.png");this.imgSwitch=THREE.ImageUtils.loadTexture("image/textures/switch.png");this.imgSelected=THREE.ImageUtils.loadTexture("image/textures/selected.png");this.imgTheftStart=THREE.ImageUtils.loadTexture("image/textures/theft_s.png");this.imgTheftEnd=THREE.ImageUtils.loadTexture("image/textures/theft_e.png");this.imgLineHead=THREE.ImageUtils.loadTexture("image/textures/line_head.png");this.imgLineHead.premultiplyAlpha=true;this.imgLineHead.needsUpdate=true;this.tweenAmount=[1,1.2,1.5,2,2.8,3.5,5,6,7,8,8,8,8,8,7,6,5,3.5,2.8,2,1.5,1.2,1],window.onresize=this.onWindowResize.bind(this);this.initWebGL()},AntiyTopo.prototype.initWebGL=function(){this.phiDiff=0,this.thetaDiff=0,this.cameraRadius=1500,this.smoothRadius=30000,this.theta=180,this.phi=45,this.PI360=Math.PI/360,this.mouseDownPhi=60,this.mouseDownTheta=45,this.pulseValue=0,this.selectedSize=1,this.camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,100000),this.camera.target=new THREE.Object3D();this.scene=new THREE.Scene,this.projector=new THREE.Projector,this.scene.fog=new THREE.Fog(0,3000,30000),this.ray=new THREE.Ray(this.camera.position,null),this.parentSpace=new THREE.Object3D();this.cloneSpace;this.doAnimation=true,this.phiAnimation=false,this.renderer=new THREE.WebGLRenderer({clearAlpha:1,antialias:true,maxLights:10}),this.renderer.setSize(window.innerWidth,window.innerHeight);document.getElementById(this.containerId).appendChild(this.renderer.domElement);object3D=new THREE.Object3D;this.selectionSprite=new THREE.Sprite({map:this.imgSelected,useScreenCoordinates:!1}),this.selectionSprite.opacity=0,this.selectionSprite.scale.set(0.5,0.5,0.5),object3D.add(this.selectionSprite),this.scene.add(object3D),this.referenceCoordinateSystem(),this.initWebGLSystems(),this.onDataSourceLoaded()},AntiyTopo.prototype.referenceCoordinateSystem=function(){var H=new THREE.MeshBasicMaterial({color:2517279,wireframe:true,wireframeLinewidth:0.1});H.color.setHSV(0.55,0.7,0.6);var J=40000,L=360,K=500,A=J/2-K;var I=new THREE.PlaneGeometry(J,J,L,L);mesh=new THREE.Mesh(I,H);mesh.position=this.middlePoint.clone();mesh.position.y-=K;mesh.rotation.x=-Math.PI/2;this.parentSpace.add(mesh)},AntiyTopo.prototype.createAxisCamera=function(H,I){this.axisHelper=new THREE.Object3D();var A=new THREE.ArrowHelper(new THREE.Vector3(1,0,0),new THREE.Vector3(),20,16711680);A.scale.set(120,120,120);A.cone.scale.set(1.5,1.5,1.5);this.axisHelper.add(A);var G=new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(),20,65280);G.scale.set(120,120,120);G.cone.scale.set(1.5,1.5,1.5);this.axisHelper.add(G);var J=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(),20,255);J.scale.set(120,120,120);J.cone.scale.set(1.5,1.5,1.5);this.axisHelper.add(J);this.axisHelper.position=new THREE.Vector3(H/2.5,this.middlePoint.y-I+50,H/2.5);this.parentSpace.add(this.axisHelper);this.axisCamera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,H/5)},AntiyTopo.prototype.renderAxisCamera=function(){var H=0;var F=0;var A=200;var G=150;this.renderer.setViewport(H,F,A,G);this.renderer.setScissor(H,F,A,G);this.renderer.enableScissorTest(true);this.axisCamera.aspect=A/G;this.axisCamera.position.x=this.axisHelper.position.x+350*Math.sin(this.theta*this.PI360)*Math.cos(this.phi*this.PI360),this.axisCamera.position.y=this.axisHelper.position.y+350*Math.sin(this.phi*this.PI360),this.axisCamera.position.z=this.axisHelper.position.z+350*Math.cos(this.theta*this.PI360)*Math.cos(this.phi*this.PI360),this.axisCamera.lookAt(this.axisHelper.position);this.axisCamera.updateProjectionMatrix();this.renderer.render(this.scene,this.axisCamera)},AntiyTopo.prototype.initWebGLSystems=function(){this.attributes={size:{type:"f",value:[]},gradient:{type:"f",value:[]},opacity:{type:"f",value:[]},acolor:{type:"c",value:[]}},size=8;hostMaterial=new THREE.ParticleBasicMaterial({color:16777215,size:size,map:this.imgHost,blending:THREE.AdditiveBlending,depthTest:false,transparent:true,vertexColors:true,opacity:1});switchMaterial=new THREE.ParticleBasicMaterial({color:16777215,size:size,map:this.imgSwitch,blending:THREE.AdditiveBlending,depthTest:false,transparent:true,vertexColors:true,opacity:1});routerMaterial=new THREE.ParticleBasicMaterial({color:16777215,size:size,map:this.imgRouter,blending:THREE.AdditiveBlending,depthTest:false,transparent:true,vertexColors:true,opacity:1});hostGeometry=new THREE.Geometry();switchGeometry=new THREE.Geometry();routerGeometry=new THREE.Geometry();for(var N=0;N<solarSystems.length;N++){var A=new THREE.Vector3(solarSystems[N][2],solarSystems[N][3],solarSystems[N][4]),J=new THREE.SphereCollider(A,60);this.attributes.acolor.value[N]=new THREE.Color,A.uid=solarSystems[N][0],A.name=solarSystems[N][1],A.region=solarSystems[N][6],A.constellation=solarSystems[N][7],A.index=N,this.solarDictionaryID[solarSystems[N][0]]=A,this.solarDictionary[A.name]=A,solarSystems[N].system=A,J.system=A,THREE.Collisions.colliders.push(J);switch(solarSystems[N][1]){case"host":hostGeometry.vertices.push(A);hostGeometry.colors.push(new THREE.Color(16777215));break;case"multi_switch":switchGeometry.vertices.push(A);switchGeometry.colors.push(new THREE.Color(16777215));break;case"router":routerGeometry.vertices.push(A);routerGeometry.colors.push(new THREE.Color(16777215));break;default:hostGeometry.vertices.push(A);hostGeometry.colors.push(new THREE.Color(16777215));break}}var I=new THREE.Geometry,J,K;for(var N=0;N<solarSystems.length;N++){J=solarSystems[N].system;for(var M=0;M<solarSystems[N][9].length;M++){K=this.solarDictionaryID[solarSystems[N][9][M]],I.vertices.push(J),I.vertices.push(K)}}var L=new THREE.LineBasicMaterial({color:35020,opacity:0.5,linewidth:1});this.line=new THREE.Line(I,L);this.hostParticles=new THREE.ParticleSystem(hostGeometry,hostMaterial);this.hostParticles.vertexColors=true;this.hostParticles.sortParticles=!1;this.switchParticles=new THREE.ParticleSystem(switchGeometry,switchMaterial);this.switchParticles.sortParticles=!1;this.routerParticles=new THREE.ParticleSystem(routerGeometry,routerMaterial);this.routerParticles.sortParticles=!1;this.parentSpace.add(this.line);this.parentSpace.add(this.hostParticles);this.parentSpace.add(this.switchParticles);this.parentSpace.add(this.routerParticles);this.scene.add(this.parentSpace)},AntiyTopo.prototype.onDataSourceLoaded=function(){for(var H=0;H<this.views.length;H++){var F;F=solarSystems;var G=adapterSecurity(F);this.datasources.push(G)}var A=this.datasources[this.settings.defaultView||0];this.resetSystems(A.defaultColor)},AntiyTopo.prototype.resetSystems=function(A){var F=this.attributes.size.value;for(var E=0;E<solarSystems.length;E++){F[E]=3}this.moveToClickedSystem(this.middlePoint.x,this.middlePoint.y,this.middlePoint.z);this.camera.target.position=this.middlePoint;this.updateCamera();this.animate()},AntiyTopo.prototype.animate=function(){if(this.isRenderer){if(this.scene.children.length<2){if(this.cloneSpace){this.parentSpace=this.cloneSpace.clone();for(i=0;i<this.cloneSpace.children.length;i++){this.parentSpace.add(this.cloneSpace.children[i])}}this.cloneSpace=null;this.scene.add(this.parentSpace)}if(!this.animation&&this.first_flag){this.doAnimation&&(this.thetaDiff=0.1),this.phiAnimation&&(this.phi>5&&(this.phiDiff=(this.phi-5)/5),this.phi<0&&(this.phiAnimation=!1)),this.phiDiff!=0&&(this.cameraChanged=!0,this.phiDiff*=0.91,this.phi-=this.phiDiff,this.phiDiff<0.001&&this.phiDiff>-0.001&&(this.phiDiff=0)),this.thetaDiff!=0&&(this.cameraChanged=!0,this.thetaDiff*=0.91,this.theta-=this.thetaDiff,this.theta<-720?this.theta=this.theta+720:this.theta>720&&(this.theta=this.theta-720),this.thetaDiff<0.001&&(this.thetaDiff>-0.001&&(this.thetaDiff=0)),this.camera.target.position=this.middlePoint);this.phi>179?this.phi=179:this.phi<-179&&(this.phi=-179);if(this.smoothRadius!=this.cameraRadius){var A=this.smoothRadius-this.cameraRadius;this.smoothRadius-=A/8;this.cameraChanged=true;this.updateSelector();this.smoothRadius>this.cameraRadius-0.005&&this.smoothRadius<this.cameraRadius+0.005&&(this.smoothRadius=this.cameraRadius)}this.cameraChanged&&(this.updateCamera(),this.cameraChanged=!1)}this.camera.lookAt(this.middlePoint)}else{if(this.scene.children.length>1){this.cloneSpace=this.parentSpace.clone();this.cloneSpace.children=this.parentSpace.children.concat();this.scene.remove(this.parentSpace)}}this.renderWebGL();requestAnimationFrame(this.animate.bind(this))},AntiyTopo.prototype.onKeyDown=function(A){switch(A.keyCode){case 32:A.preventDefault();lineId=[81347,81342,81419,81309,81311];this.getPath(lineId);break}},AntiyTopo.prototype.getPath=function(Q){var N=new THREE.Geometry();N.dynamic=true;N.verticesNeedUpdate=true;N.colorsNeedUpdate=true;var P=this.solarDictionaryID[Q[0]];var L=[];for(i=0;i<Q.length-1;i++){var S=this.solarDictionaryID[Q[i]];var R=this.solarDictionaryID[Q[i+1]];var O=(R.x-S.x)/this.lineSplice;var T=(R.y-S.y)/this.lineSplice;var A=(R.z-S.z)/this.lineSplice;N.vertices.push(P);L.push(S);for(j=1;j<this.lineSplice-1;j++){L.push(new THREE.Vector3(S.x+j*O,S.y+j*T,S.z+j*A));N.vertices.push(P)}N.vertices.push(P);L.push(R)}var M=new THREE.Line(N,this.moveLineMaterial,THREE.LinePieces);this.moveLines.push({"line":M,"line_splice":(this.lineSplice)*(Q.length-1),"go_vertices":L,"sprite_group":this.createSprites(Q),"is_complate":false});this.parentSpace.add(M)},AntiyTopo.prototype.createSprites=function(A,a){var R=0.8,b=16711680,S=16711680,T=16715520,d=16711680,Q=this.imgTheftStart;end_sprite_map=this.imgTheftEnd,head_sprite_map=this.imgLineHead;var Z={groupChildren:new THREE.Object3D(),moveSprite:null,moveArrow:null};var U=this.solarDictionaryID[A[0]];var V=this.solarDictionaryID[A[A.length-1]];var c=new THREE.Sprite({color:b,map:Q,useScreenCoordinates:false});c.position.set(U.x,U.y,U.z),c.opacity=R,Z.groupChildren.add(c);var W=new THREE.Sprite({color:S,map:end_sprite_map,useScreenCoordinates:false});W.position.set(V.x,V.y,V.z),W.opacity=R,Z.groupChildren.add(W);var Y=new THREE.Sprite({color:T,map:head_sprite_map,useScreenCoordinates:false,blending:THREE.AdditiveBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.SrcColorFactor,blendEquation:THREE.AddEquation});Y.position.set(U.x,U.y,U.z),Y.opacity=R,Z.moveSprite=Y;Z.groupChildren.add(Y);var X=new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(U.x,U.y+1000,U.z),1,d);for(i=0;i<X.children.length;i++){if(X.children[i] instanceof THREE.Line){X.children[i].visible=false;X.children[i].scale.set(1,2,1)}else{if(X.children[i] instanceof THREE.Mesh){X.children[i].scale.set(300,600,300)}}}Z.moveArrow=X;Z.groupChildren.add(X);this.parentSpace.add(Z.groupChildren);return Z},AntiyTopo.prototype.updateSelector=function(){var A=Math.max(this.smoothRadius/8000,this.selectedSize/5);this.selectionSprite.scale.set(A,A,A)},AntiyTopo.prototype.updateRotationSprite=function(A){var D=Math.max(this.smoothRadius/8000,this.selectedSize/5);A.scale.set(D,D,D)},AntiyTopo.prototype.onMouseMove=function(F){if(this.mouseDownButton==0){var A=-(F.clientX-this.mouseDownPoint.x)+this.mouseDownTheta;var E=F.clientY-this.mouseDownPoint.y+this.mouseDownPhi;E=Math.min(179,Math.max(-179,E)),this.phiDiff+=(this.lastPhi-E)*0.08,this.thetaDiff+=(this.lastTheta-A)*0.08,this.lastPhi=E,this.lastTheta=A,this.camera.updateProjectionMatrix()}return !1},AntiyTopo.prototype.onMouseDown=function(A){this.mouseDownPoint.x=A.clientX,this.mouseDownPoint.y=A.clientY,this.mouseLastMovePoint.x=A.clientX,this.mouseLastMovePoint.y=A.clientY,this.mouseDownButton=A.button,this.mouseDownButton==0&&(this.doAnimation=!1),this.lastPhi=this.phi,this.lastTheta=this.theta,this.mouseDownTheta=this.theta,this.mouseDownPhi=this.phi,this.mouseMoveHandler||(this.mouseMoveHandler=this.onMouseMove.bind(this)),document.addEventListener("mousemove",this.mouseMoveHandler,!1),this.onMouseUpHandler=this.onMouseUp.bind(this),window.addEventListener("mouseup",this.onMouseUpHandler,!1)},AntiyTopo.prototype.onMouseUp=function(T){T.preventDefault(),this.mouseMoveHandler&&(document.removeEventListener("mousemove",this.mouseMoveHandler,!1),this.mouseMoveHandler=null),this.onMouseUpHandler&&window.removeEventListener("mouseup",this.onMouseUpHandler,!1);this.doAnimation=!0;var V,W,e,X=-1;V=this.mouseDownPoint.x-T.clientX,W=this.mouseDownPoint.y-T.clientY;var U=V*V+W*W;if(U>9){return !1}var d,Z,a,b,c=$("#"+this.containerId).offset();this.fullscreen?(d=T.clientX,Z=T.clientY):(d=T.pageX-c.left,Z=T.pageY-c.top);d=d/window.innerWidth*2-1,Z=-(Z/window.innerHeight)*2+1;var f=new THREE.Vector3(d,Z,0.5),A=this.projector.unprojectVector(f,this.camera);this.ray.direction=A.subSelf(this.camera.position).normalize();var R=THREE.Collisions.rayCastAll(this.ray);if(R.length>0){for(var S=0;S<R.length;S++){var Y=R[S];if(Y.system==this.selectedSystem){continue}V=Y.system.x-this.camera.position.x,W=Y.system.y-this.camera.position.y,e=Y.system.z-this.camera.position.z,a=V*V+W*W+e*e;if(X==-1||a<X){b=R[S].system,X=a}}if(b==undefined){return}this.selectedSystem=b,this.selectedSize=this.attributes.size.value[this.selectedSystem.index],this.selectionSprite.position.set(b.x,b.y,b.z),this.selectionSprite.opacity=0.8,this.animDeltaX=this.selectedSystem.x-this.camera.target.position.x;this.animDeltaY=this.selectedSystem.y-this.camera.target.position.y;this.animDeltaZ=this.selectedSystem.z-this.camera.target.position.z;this.moveToClickedSystem(this.animDeltaX+this.camera.target.position.x,this.animDeltaY+this.camera.target.position.y,this.animDeltaZ+this.camera.target.position.z);this.showPopup()}else{this.selectedSystem!=null&&this.closePopup()}},AntiyTopo.prototype.moveToClickedSystem=function(A,I,J){if(this.first_flag){if(this.moveCount<23&&(A!=this.camera.target.position.x||I!=this.camera.target.position.y||J!=this.camera.target.position.z)){this.mapMoving=!0;var K=this.animDeltaX*this.tweenAmount[this.moveCount]/100,L=this.animDeltaY*this.tweenAmount[this.moveCount]/100,H=this.animDeltaZ*this.tweenAmount[this.moveCount]/100;this.moveCount==22?(this.camera.target.position.x=A,this.camera.target.position.y=I,this.camera.target.position.z=J):(this.camera.target.position.x+=K,this.camera.target.position.y+=L,this.camera.target.position.z+=H),this.middlePoint.x=this.camera.target.position.x;this.middlePoint.y=this.camera.target.position.y;this.middlePoint.z=this.camera.target.position.z;this.updateCamera(),this.moveCount++;requestAnimationFrame(this.moveToClickedSystem.bind(this,A,I,J))}else{this.mapMoving=!1,this.moveCount=0}}},AntiyTopo.prototype.updateCamera=function(){this.camera.position.x=this.camera.target.position.x+this.smoothRadius*Math.sin(this.theta*this.PI360)*Math.cos(this.phi*this.PI360),this.camera.position.y=this.camera.target.position.y+this.smoothRadius*Math.sin(this.phi*this.PI360),this.camera.position.z=this.camera.target.position.z+this.smoothRadius*Math.cos(this.theta*this.PI360)*Math.cos(this.phi*this.PI360),this.camera.updateProjectionMatrix()},AntiyTopo.prototype.onMouseWheel=function(D){D.preventDefault();var A=0;D||(D=window.event),D.wheelDeltaY!=undefined&&!isNaN(D.wheelDeltaY)?A=D.wheelDeltaY:D.wheelDelta?D.wheelDelta>0?A=120:D.wheelDelta<0&&(A=-120):D.detail&&(D.detail<0?A=120:D.detail>0&&(A=-120)),A>0?this.cameraRadius-=2*A+this.cameraRadius/10:this.cameraRadius+=2*A*-1+this.cameraRadius/10;this.cameraRadius<1&&(this.cameraRadius=1);this.cameraRadius<120*this.selectedSize?this.cameraRadius=120*this.selectedSize:this.cameraRadius>8000&&(this.cameraRadius=8000);D.returnValue=!1,D.cancelBubble=!0},AntiyTopo.prototype.onWindowResize=function(){this.camera.aspect=window.innerWidth/window.innerHeight;this.updateCamera();this.renderer.setSize(window.innerWidth,window.innerHeight)},window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(D,A){window.setTimeout(D,1000/60)}}(),AntiyTopo.prototype.showPopup=function(){$("#node_attr_panel").animate({"left":"25px","opacity":"1"},500);$("#node_id").html(this.selectedSystem.uid);console.log(this.selectedSystem.uid)},AntiyTopo.prototype.closePopup=function(){$("#node_attr_panel").animate({"left":"-200px","opacity":"0"},500);this.selectionSprite.opacity=0},AntiyTopo.prototype.renderWebGL=function(){var Y=this.moveLines;for(i=0;i<Y.length;i++){var W=Y[i].line.geometry;var S=Y[i].sprite_group;var X=true;if(Y[i].go_vertices.length>0&&!Y[i].is_complate){var R;if(Y[i].go_vertices.length>=this.lineSplice){R=Y[i].go_vertices[this.lineSplice-1]}var b=Y[i].go_vertices.shift();if(!R){R=b}var V=Y[i].line_splice-Y[i].go_vertices.length-1;if(R.uid){S.moveArrow.setDirection(R.clone().subSelf(b).normalize())}for(j=V;j<W.vertices.length;j++){W.vertices[j]=b;S.moveArrow.position=b;S.moveSprite.position=b}W.verticesNeedUpdate=true}else{if(!Y[i].is_complate){Y[i].is_complate=true}if(Y[i].line){if(Y[i].line.geometry.vertices.length>0&&Y[i].is_complate){var T=Y[i].line.geometry.vertices.shift();Y[i].line.geometry.verticesNeedUpdate=true}else{if(Y[i].line!=null){var a=Y[i].sprite_group.groupChildren;a.remove(S.moveArrow);S.moveArrow=null;a.remove(S.moveSprite);S.moveSprite=null;this.parentSpace.remove(Y[i].line)}}}}if(X){var d=S.groupChildren;for(var U=0;U<d.children.length;U++){this.updateRotationSprite(d.children[U])}}}var Q=0,Z=0,A=window.innerWidth,c=window.innerHeight;this.renderer.setViewport(Q,Z,A,c);this.renderer.setScissor(Q,Z,A,c);this.renderer.enableScissorTest(true);this.renderer.setClearColor({r:0,g:0,b:0,a:0},1);this.renderer.render(this.scene,this.camera)},AntiyTopo.prototype.getData=function(){var A=this.analyData.bind(this);$.ajax({url:"data.xml",dataType:"xml",cache:false,success:function(D){A(D)}})},AntiyTopo.prototype.analyData=function(AU){var A2=0,A5=0,A4=0,A=0,AO=0,Bj=0,AM=[],AY={};var Bi=-4000,AG=200,A8=0,Aq=160,AC=80,AD=4,Bk=0,Bh=0,At=100,Ba=150,Au=100,AX=50,Bl=200,Ay=100,AF=50,AP=150,Bb=100,AK=0,AJ=0,A0=0,AW=0,A7=0,A6=0,Ao=0,As=0,Bg=0,Bd="",A9="",Be="",AV="",Ar="",AI="",AS="",AZ="",AR=0,Av=0,Bf=0,Bc=0,AE=0,AT=0,An=false,AL=[],Az={},AB={},A1=[],A3={},AA=[],Ap=[],AH=[],Ax=[];var Aw=0;$(AU).find("node").each(function(I){Bd=$(this).attr("id");A9=$(this).children("infraStructure").attr("uid");if(A9=="router"){AK=$(this).attr("dx")*AD+Bi;A0=$(this).attr("dy")*AD+A8;AJ=0+AG;AQ(AK,AJ,A0);var F=new THREE.Vector3(AK,AJ,A0);Az[Bd]=F;AL.push(Bd);Ap=[];A1=[];$(AU).find("link").each(function(L){An=false;if($(this).attr("source")==Bd){Be=$(this).attr("target");An=true;Ap.push(Be)}if($(this).attr("target")==Bd){Be=$(this).attr("source");An=true;Ap.push(Be)}if(An){if(!Az[Be]){$(AU).find("node").each(function(M){AV=$(this).attr("id");Ar=$(this).children("infraStructure").attr("uid");if(Be==AV&&(Ar=="multi_switch"||Ar=="host")){AB={};AB["node_id"]=AV;AB["node_type"]=Ar;A1.push(AB)}})}}});AM.push(Bd);AY[Bd]={};AY[Bd]["type"]=A9;AY[Bd]["links"]=Ap;AY[Bd]["position"]=[AK,AJ,A0];Bk=A1.length;AR=AK;Bf=A0;Av=AJ-Bl;var H=360/Bk;if(Bk==1){H=0}for(var E=0;E<Bk;E++){var G=AN(AR,Bf,0,H*(E+1),Aq);AW=G[0];A6=G[1];A7=AJ-Bl;AQ(AW,A7,A6);var C=new THREE.Vector3(AW,A7,A6);Az[A1[E]["node_id"]]=C;AL.push(A1[E]["node_id"]);AH=[];AV=A1[E]["node_id"];Ar=A1[E]["node_type"];AA=[];$(AU).find("link").each(function(L){An=false;if($(this).attr("source")==AV){AI=$(this).attr("target");An=true;AH.push(AI)}if($(this).attr("target")==AV){AI=$(this).attr("source");An=true;AH.push(AI)}if(An){if(!Az[AI]){$(AU).find("node").each(function(M){AS=$(this).attr("id");AZ=$(this).children("infraStructure").attr("uid");if(AI==AS&&(AZ=="multi_switch"||AZ=="host")){A3={};A3["node_id"]=AS;A3["node_type"]=AZ;AA.push(A3)}})}}});AM.push(AV);AY[AV]={};AY[AV]["type"]=Ar;AY[AV]["links"]=AH;AY[AV]["position"]=[AW,A7,A6];Bh=AA.length;Bc=AW;AT=A6;AE=A7-AP;var D=360/Bh;if(Bh==1){D=0}for(var J=0;J<Bh;J++){AS=AA[J]["node_id"];Ao=AW+AF*J;if(J%3==0){Bg=A6+0}if(J%3==1){Bg=A6+Bb}if(J%3==2){Bg=A6-Bb}As=A7-AP;AQ(Ao,As,Bg);var K=new THREE.Vector3(Ao,As,Bg);Az[AA[J]["node_id"]]=K;AL.push(AA[J]["node_id"]);Ax=[];$(AU).find("link").each(function(L){An=false;if($(this).attr("source")==AS){third_target_id=$(this).attr("target");Ax.push(third_target_id)}});AM.push(AS);AY[AS]={};AY[AS]["type"]=AA[J]["node_type"];AY[AS]["links"]=Ax;AY[AS]["position"]=[Ao,As,Bg]}}}});if(AL.length==0){$(AU).find("node").each(function(E){Bd=$(this).attr("id");A9=$(this).children("infraStructure").attr("uid");if(A9=="multi_switch"){Ap=[];A1=[];$(AU).find("link").each(function(I){An=false;if($(this).attr("source")==Bd){Be=$(this).attr("target");An=true;Ap.push(Be)}if($(this).attr("target")==Bd){Be=$(this).attr("source");An=true;Ap.push(Be)}if(An){if(!Az[Be]){$(AU).find("node").each(function(J){AV=$(this).attr("id");Ar=$(this).children("infraStructure").attr("uid");if(Be==AV&&Ar=="host"){AB={};AB["node_id"]=AV;AB["node_type"]=Ar;A1.push(AB)}})}}});Bk=A1.length;if(Bk==1){AJ=500+AG}else{AJ=0+AG+Math.floor(Math.random()*200)}AK=$(this).attr("dx")*AD+Bi;A0=$(this).attr("dy")*AD+A8;AQ(AK,AJ,A0);var H=new THREE.Vector3(AK,AJ,A0);Az[Bd]=H;AL.push(Bd);AM.push(Bd);AY[Bd]={};AY[Bd]["type"]=A9;AY[Bd]["links"]=Ap;AY[Bd]["position"]=[AK,AJ,A0];AR=AK;Bf=A0;Av=AJ-Bl;var D=360/Bk;if(Bk==1){D=0}for(var C=0;C<Bk;C++){var F=AN(AR,Bf,0,D*(C+1),Aq);AW=AK+AX*C;if(C%3==0){A6=A0+0}if(C%3==1){A6=A0+Ay}if(C%3==2){A6=A0-Ay}if(C%2==0){A7=AJ-Bl}if(C%2==1){A7=AJ-Bl-100}AQ(AW,A7,A6);var G=new THREE.Vector3(AW,A7,A6);Az[A1[C]["node_id"]]=G;AL.push(A1[C]["node_id"]);AH=[];AV=A1[C]["node_id"];Ar=A1[C]["node_type"];AM.push(AV);AY[AV]={};AY[AV]["type"]=Ar;AY[AV]["links"]=AH;AY[AV]["position"]=[AW,A7,A6]}}})}for(Aw=0;Aw<AM.length;Aw++){pid=AM[Aw];solarSystems.push([pid,AY[pid]["type"],AY[pid]["position"][0],AY[pid]["position"][1],AY[pid]["position"][2],0.9,"Derelik","San Matar",3802,AY[pid]["links"]])}console.log(AY);function AN(J,C,H,I,D){if(I==0){return[J,C]}else{a1=(H%360)*Math.PI/180;a2=(I%360)*Math.PI/180;var G=J+D*Math.cos(a2);var E=C+D*Math.sin(a2);var F=[];F.push(G);F.push(E);return F}}function AQ(C,D,E){if(C>A2){A2=C}if(D>A5){A5=D}if(E>A4){A4=E}if(C<A){A=C}if(D<AO){AO=D}if(E<Bj){Bj=E}}this.middlePoint=new THREE.Vector3((A2+A)/2,(A5+AO)/2,(A4+Bj)/2);this.init()},this.init()};